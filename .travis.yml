language: node_js
node_js:
  - "12.13.1"

cache: yarn

install:
  - yarn global add lerna jest now
  - lerna bootstrap

matrix:
  include:
    - name: dmgdesign Pipeline
      env: PACKAGE_LOCATION=packages/dmgdesign PACKAGE_NAME=cbeyondvr-monorepo DEPLOY_TO=dmgdesignsf
    - name: villa-clementine Pipeline
      env: PACKAGE_LOCATION=packages/villa-clementine PACKAGE_NAME=cbeyondvr-monorepo  DEPLOY_TO=villa-clementine

cache:
  directories:
    - node_modules/
    - $PACKAGE_LOCATION/.cache

script:
  - cd packages/ui-kit
  - yarn build
  - cd ../../$PACKAGE_LOCATION
  - yarn build
#  - yarn test

# script: now --token=$NOW_TOKEN --target staging
deploy:
  provider: script
  script: yarn run now ./$DEPLOY_TO_PREFIX$DEPLOY_TO --token=$NOW_TOKEN --target production
  skip_cleanup: true
  app: $PACKAGE_NAME
  on:
    all_branches: true
branches:
  only:
    - master
