---
title: PrismJs test
---

this is a test

```python
from itertools import cycle
import json
import logging
from operator import itemgetter
import os
import shutil
import subprocess

from aptol.interfaces.infra import EPSILON
from aptol.utils import Logger


def compareRootCauses(tacRc, expectedRc, logger):
    def compare(list1, list2):
        list1.sort()
        list2.sort()
        return list1 == list2

    firstReportedDict = None
    firstReport = False
    expected = cycle(expectedRc)
    for _ts, _tsDict in sorted(tacRc.items(), key=itemgetter(0)):
        if firstReportedDict is None:
            firstReportedDict = _tsDict['probRootCause']
            firstReport = True
        else:
            firstReport = False
        rootCauses = _tsDict['probRootCause']

        filteredRc = {}
        if not firstReport:
            # initialise with the first reported report
            for _rcName, _rcDict in firstReportedDict.items():
                if _rcName.find('ExecConfigId') > -1:
                    continue
                if _rcDict["endTime"]["secs"] != 0 or _rcDict["endTime"]["usecs"] != 0:
                    # drop expired root causes
                    continue
                filteredRc[_rcName] = _rcDict

        for _rcName, _rcDict in rootCauses.items():
            if _rcDict["endTime"]["secs"] != 0 or _rcDict["endTime"]["usecs"] != 0:
                # drop expired root causes
                logger._logInfo(
                    'expired rootcause: {} @ {}'.format(
                        _rcName, _rcDict["endTime"]))
                if firstReport:
                    continue
                else:
                    if _rcName in filteredRc:
                        del filteredRc[_rcName]
                        continue
            _rcDict['reportTimestamp'] = _ts
            filteredRc[_rcName] = _rcDict
            if len(filteredRc) == 0:
                msg = 'tacfsd root cause empty @ {}'.format(_ts)
                logger._logError(msg)
                raise Exception(msg)
        rcList = list(map(lambda x: x.replace('nv/', ''), filteredRc.keys()))

        # pass all timestamps until we get to the facfsd timestamp
        matched = False
        while not matched:
            expectedTimestampDict = next(expected)  # one entry dictionary
            for _tse, _rce in expectedTimestampDict.items():
                if abs(float(_tse) - float(_ts)) < EPSILON:
                    if not compare(rcList, _rce):
                        msg = 'tacfsd root cause not as expected @ {}:\n\texpected: {}\n\t: tacfsd result: {}'.format(
                            _ts, json.dumps(_rce, indent=3), json.dumps(rcList, indent=3))
                        logger._logError(msg)
                        raise Exception(msg)
                    matched = True
                elif float(_tse) > float(_ts):
                    msg = 'tacfsd root cause timestamp {} not found in the expected root cause lists'.format(
                        _ts)
                    logger._logError(msg)
                    raise Exception(msg)
    # for the last identified matched rootcause list
    # check against the expected root cause timestamps until their end
    try:
        while True:
            expectedTimestampDict = next(expected)  # one entry dictionary
            for _tse, _rce in expectedTimestampDict.items():
                if not compare(rcList, _rce):
                    msg = 'tacfsd root cause not as expected @ {}:\n\texpected: {}\n\t: tacfsd result: {}'.format(
                        _ts, json.dumps(_rce, indent=3), json.dumps(rcList, indent=3))
                    logger._logError(msg)
                    raise Exception(msg)
                matched = True
        pass
    except Exception as e:
        raise e

```
